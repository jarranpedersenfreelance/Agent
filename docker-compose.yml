version: '3.8'
services:
  agent:
    build: .
    image: scion-agent:latest
    container_name: nextgen_agent_dev
    working_dir: /app/workspace
    
    # CRITICAL FIX: Set PYTHONPATH so Python can find 'secondary' module.
    # CRITICAL FIX: Changed python execution command to run from workspace root.
    command: >
      /bin/sh -c "
      echo 'Initializing workspace from source...' &&
      cp -R /app/src/. /app/workspace/ &&
      echo 'Workspace ready. Starting Agent.' &&
      PYTHONPATH=/app/workspace python3 core/agent_core.py
      "
      
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
    volumes:
      - ./src:/app/src:ro
      - ./workspace:/app/workspace
    restart: unless-stopped